

一、项目背景

- 项目名称: 机器人数据管理平台
- 数据格式: LeRobot v3.0
- 后端技术: FastAPI + PostgreSQL + MinIO
- 业务流程: 上传数据集 → 命名校验 → 脚本解析 → 入库


---

二、脚本功能

1. 解析 LeRobot v3.0 数据集结构
2. 切割视频：每个Episode对应一个或多个视频文件（支持多摄像头）
3. 生成缩略图：为每个视频生成缩略图
4. 提取文件信息（路径、大小、元数据）
5. 返回结构化JSON数据

---

三、输入参数

调用方式

from parser_service import parse_dataset

result = parse_dataset(
    dataset_path="/path/to/dataset",
    dataset_name="so101_pick_cube_2025-01-23"
)

参数说明

参数名
类型
必需
说明
dataset_path
string
✅
LeRobot v3.0数据集的本地路径
dataset_name
string
✅
通过命名校验后的新名称


---

四、输出格式

整体结构

{
  "success": true,
  "message": "解析成功",
  "dataset_info": {...},
  "robot_info": {...},
  "tasks": [...],
  "episodes": [...]
}

1. dataset_info（数据集基本信息）

从 meta/info.json 读取：

{
  "codebase_version": "v3.0",
  "robot_type": "so101_follower",
  "fps": 30,
  "total_episodes": 175,
  "total_frames": 78622,
  "total_tasks": 1,
  "total_size_bytes": 1073741824
}

字段说明：
- codebase_version: LeRobot版本号
- robot_type: 机器人类型（so100/so101/so101_follower/aloha/aloha_mobile）
- fps: 帧率
- total_episodes: 总Episode数
- total_frames: 总帧数
- total_tasks: 总任务数
- total_size_bytes: 数据集总大小（字节）

---

2. robot_info（机器人信息）

{
  "robot_id": "so101_follower",
  "robot_type": "so101_follower",
  "name": "SO101 Follower Robot",
  "model": "SO101",
  "description": "SO101 Follower机器人",
  "status": "active"
}


---

3. tasks（任务列表）

从 meta/tasks.parquet 读取：

{
  "tasks": [
    {
      "task_index": 0,
      "task_description": "抓取方块"
    }
  ]
}


---

4. episodes（Episodes列表）⭐ 最重要

从 meta/episodes/*.parquet 读取，每个Episode包含完整信息：

{
  "episodes": [
    {
      "episode_index": 0,
      "task_index": 0,
      "length": 450,
      "data_chunk_index": 0,
      "data_file_index": 0,
      "capture_time": "2025-01-23T12:00:00Z",
      "data_files": {
        "video": [...],
        "images": [...],
        "parquet": [...]
      }
    }
  ]
}

Episode基础信息

字段名
类型
必需
说明
episode_index
integer
✅
Episode索引（从0开始）
task_index
integer
✅
关联的任务索引
length
integer
✅
帧数
data_chunk_index
integer
✅
数据块索引
data_file_index
integer
✅
文件索引
capture_time
string
❌
采集时间（ISO 8601格式）


---

data_files.video（视频文件）⭐ 关键

每个Episode可能有一个或多个视频文件（每个摄像头一个）！

{
  "video": [
    {
      "type": "video",
      "feature_name": "observation.images.top",
      "original_file_path": "videos/observation.images.top/chunk-000/file-000.mp4",
      "cut_file_path": "videos_cut/episode_000_top.mp4",
      "thumbnail_path": "thumbnails/episode_000_top.jpg",
      "size_bytes": 1024000,
      "mime_type": "video/mp4",
      "metadata": {
        "width": 640,
        "height": 480,
        "duration_seconds": 15.0,
        "fps": 30,
        "codec": "av1",
        "frame_count": 450
      }
    },
    {
      "type": "video",
      "feature_name": "observation.images.front",
      "original_file_path": "videos/observation.images.front/chunk-000/file-000.mp4",
      "cut_file_path": "videos_cut/episode_000_front.mp4",
      "thumbnail_path": "thumbnails/episode_000_front.jpg",
      "size_bytes": 1024000,
      "mime_type": "video/mp4",
      "metadata": {
        "width": 640,
        "height": 480,
        "duration_seconds": 15.0,
        "fps": 30,
        "codec": "av1",
        "frame_count": 450
      }
    }
  ]
}

关键字段说明：

字段名
类型
必需
说明
type
string
✅
固定为 "video"
feature_name
string
✅
特征名称（如 observation.images.top）
original_file_path
string
✅
原始视频文件路径（相对路径）
| `cut_file_path` | string | ✅ | 切割后的视频路径（相对路径）|
| `thumbnail_path` | string | ✅ | 缩略图路径（相对路径）|
| size_bytes | integer | ✅ | 文件大小（字节）|
| mime_type | string | ✅ | MIME类型 |
| metadata.width | integer | ✅ | 视频宽度 |
| metadata.height | integer | ✅ | 视频高度 |
| metadata.duration_seconds | float | ✅ | 视频时长（秒）|
| metadata.fps | integer | ✅ | 帧率 |
| metadata.codec | string | ✅ | 编码格式 |
| `metadata.frame_count` | integer | ✅ | 视频帧数 ⭐ |


---

data_files.images（图片文件）

{
  "images": [
    {
      "type": "image",
      "feature_name": "observation.images.top",
      "file_path": "images/observation.images.top/episode_000.jpg",
      "size_bytes": 51200,
      "mime_type": "image/jpeg",
      "metadata": {
        "width": 640,
        "height": 480,
        "format": "jpeg"
      }
    }
  ]
}


---

data_files.parquet（Parquet文件）

{
  "parquet": [
    {
      "type": "parquet",
      "feature_name": "data",
      "file_path": "data/chunk-000/file-000.parquet",
      "size_bytes": 204800,
      "mime_type": "application/octet-stream",
      "metadata": {
        "num_rows": 450,
        "num_columns": 10,
        "columns": ["action", "observation.state", "observation.images.top"]
      }
    }
  ]
}


---

五、文件命名规范

视频文件命名

episode_{index}_{camera_name}.mp4

示例：
- episode_000_top.mp4
- episode_000_front.mp4
- episode_000_wrist.mp4
- episode_001_top.mp4
说明：